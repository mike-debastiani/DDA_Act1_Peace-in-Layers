<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Isometric Layers â€“ Community Data</title>

    <style>
      :root {
        --text: #111;
        --muted: #666;
        --bg: #fff;
        --pill-bg: #f7f7f7;
        --pill-hover: #eaeaea;
        --pill-border: #e1e1e1;
      }

      html,
      body {
        height: 100%;
        margin: 0;
        overflow: hidden;
        background: var(--bg);
        color: var(--text);
        font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu,
          Cantarell, "Helvetica Neue", Arial, "Noto Sans";
      }

      .wrap {
        display: flex;
        height: 100vh;
        width: 100vw;
        overflow: hidden;
      }

      /* ==== SIDEBAR LAYOUT ==== */
      .panel {
        flex: 0 0 40vw;
        max-width: 40vw;
        min-width: 260px;
        border-right: 1px solid #e5e5e5;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        background: #fff;
        height: 100vh;
        overflow: hidden;
      }

      .panelScroll {
        flex: 1 1 auto;
        box-sizing: border-box;
        padding: 16px;
        overflow-y: auto;
        overflow-x: hidden !important;
        max-height: 100%;
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      .panelScroll::-webkit-scrollbar {
        display: none;
      }

      .clearBar {
        flex: 0 0 auto;
        border-top: 1px solid #eee;
        padding: 10px 16px 12px;
        background: #fff;
      }

      #indWrap,
      #subsWrap,
      #catsWrap,
      #dimsWrap,
      #indicatorList,
      #subPills,
      #catPills,
      #dimPills {
        max-height: unset !important;
        overflow: visible !important;
      }

      /* ====== TITLE HEADER (top row with name + Votes button) ====== */
      .titleTop {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        flex-wrap: wrap;
        column-gap: 8px;
        row-gap: 4px;
        margin: 0 0 24px;
      }

      .titleTop h1 {
        margin: 0;
        font-size: 28px;
        font-weight: 800;
        color: #111;
        line-height: 1.2;
      }

      /* Clickable "Votes" header button on the right */
      .votesHeaderBtn {
        appearance: none;
        background: transparent;
        border: 0;
        padding: 0;
        margin: 0;
        cursor: pointer;

        display: inline-flex;
        align-items: baseline;
        gap: 4px;

        font-size: 12px;
        line-height: 1.2;
        color: var(--muted);

        text-transform: uppercase;
        letter-spacing: 0.04em;

        flex-shrink: 0;
        text-align: right;
      }
      .votesHeaderBtn.right {
        margin-left: auto;
      }

      /* number next to "Votes" */
      .topVotesNumber {
        font-weight: 400;
        line-height: 1.2;
        opacity: 0.6;
        font-variant-numeric: tabular-nums;
      }

      /* hover hint for interactivity */
      .votesHeaderBtn:hover {
        color: #ed3c1a;
      }
      .votesHeaderBtn:hover .topVotesNumber {
        color: #ed3c1a;
        opacity: 1;
      }

      /* ACTIVE STATE (after click) */
      /* Active state now DOES NOT change text color.
   The orange outline is handled by .votesHeaderWrap.hlHeader instead. */
      .votesHeaderBtn.active {
        color: var(--muted);
      }
      .votesHeaderBtn.active .topVotesNumber {
        color: var(--muted);
        opacity: 0.6;
      }

      /* ===== SECTIONS IN SIDEBAR ===== */
      .section {
        margin-bottom: 12px;
        overflow-x: hidden !important;
      }

      .sectionHead {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        margin: 4px 0 6px;
        overflow-x: hidden !important;
        gap: 8px;
      }

      .leftHead {
        display: flex;
        flex-direction: column;
        min-width: 0;
      }

      .titleLine {
        display: flex;
        align-items: baseline;
        flex-wrap: wrap;
        column-gap: 4px;
      }

      .sectionHead h3 {
        margin: 0;
        font-size: 12px;
        color: var(--muted);
        text-transform: uppercase;
        letter-spacing: 0.04em;
        display: inline-flex;
        align-items: baseline;
        gap: 4px;
        flex-shrink: 0;
      }

      .count {
        opacity: 0.6;
      }

      .sectionToggleBtn {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        background: transparent;
        border: 0;
        border-radius: 6px;
        cursor: pointer;
        font-size: 12px;
        font-weight: 500;
        color: #111;
        opacity: 0.7;
        padding: 4px 6px;
        line-height: 1;
        flex-shrink: 0;
      }
      .sectionToggleBtn:hover {
        background: #f3f3f3;
        opacity: 1;
      }

      .chev {
        font-size: 14px;
        line-height: 1;
        display: inline-block;
        transition: transform 0.12s ease;
      }
      .sectionToggleBtn[aria-expanded="false"] .chev {
        transform: rotate(-90deg);
      }
      .sectionToggleBtn[aria-expanded="true"] .chev {
        transform: rotate(0deg);
      }

      /* ===== INDICATOR LIST ===== */
      .indList {
        margin: 0;
        padding: 0;
        list-style: none;
        overflow-x: hidden !important;
      }

      .indItem {
        position: relative;
        display: flex;
        gap: 10px;
        align-items: baseline;
        cursor: pointer;
        padding: 6px 8px 6px 16px;
        border: none;
        margin: 2px 0;
        background: transparent;
        transition: background-color 120ms ease, opacity 120ms ease;
        overflow-x: hidden !important;
        color: #111;
      }
      .indItem:hover {
        background: #f6f6f6;
      }

      .indItem::before {
        content: "";
        position: absolute;
        left: 6px;
        top: 6px;
        bottom: 6px;
        width: 3px;
        border-radius: 2px;
        background: #e5e7eb;
      }

      .indLabel {
        font-weight: 600;
        line-height: 1.35;
        color: #111;
        word-break: break-word;
      }

      .indVotes {
        margin-left: auto;
        min-width: 26px;
        text-align: right;
        font-weight: 700;
        opacity: 0.9;
        font-variant-numeric: tabular-nums;
        color: #111;
      }

      /* state classes for clicked/related indicators */
      .ind--selected::before,
      .ind--affected::before {
        background: #ed3c1a;
      }

      .ind--dimmed .indLabel,
      .ind--dimmed .indVotes {
        color: #888;
        opacity: 0.55;
      }

      .indItem * {
        pointer-events: none;
      }

      /* ===== PILLS ===== */
      .pill {
        display: inline-block;
        padding: 4px 10px;
        margin: 3px 6px 0 0;
        border-radius: 999px;
        background: var(--pill-bg);
        border: 1px solid var(--pill-border);
        color: var(--text);
        white-space: nowrap;
        user-select: none;
        cursor: pointer;
        transition: background-color 120ms ease, border-color 120ms ease,
          color 120ms ease;
        max-width: 100%;
      }
      .pill:hover {
        background: var(--pill-hover);
      }
      .pill.active {
        background: #ed3c1a;
        border-color: #ed3c1a;
        color: #fff;
      }
      .pill.dim {
        opacity: 0.5;
      }

      .pill .pillCount {
        margin-left: 6px;
        opacity: 0.75;
        font-size: 12px;
        font-weight: 700;
        font-variant-numeric: tabular-nums;
      }

      /* ===== CLEAR BUTTON BAR ===== */
      .clearInner {
        display: flex;
        justify-content: flex-end;
        align-items: center;
      }

      .clearBtn {
        background: #2b2b2b;
        color: #fff;
        border: 0;
        border-radius: 14px;
        padding: 8px 12px;
        font-weight: 600;
        cursor: pointer;
        font-size: 13px;
        line-height: 1.2;
        white-space: nowrap;
      }
      .clearBtn:hover {
        background: #1f1f1f;
      }

      /* highlight tint block behind whichever layer is selected */
      /* highlight block behind whichever layer is selected */
      .hl {
        position: relative;
        z-index: 0;
      }

      .hl::before {
        content: "";
        position: absolute;
        left: -16px;
        right: -16px;
        top: -12px;
        bottom: -12px;

        background: transparent; /* no fill */
        border: 2px solid #ed3c1a; /* thick orange outline */
        border-radius: 6px; /* tiny rounding so it feels intentional */

        pointer-events: none;
        z-index: -1;
      }

      /* ===== RIGHT SIDE CANVAS ===== */
      .canvasWrap {
        flex: 1 1 60vw;
        position: relative;
        overflow: hidden;
        isolation: isolate;
        background: #fff;
      }
      .canvasWrap canvas {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        display: block;
        z-index: 0;
      }

      .zoomBtn {
        position: absolute;
        right: 16px;
        bottom: 16px;
        z-index: 20;
        width: auto;
        background: #2b2b2b;
        color: #fff;
        border: 0;
        border-radius: 14px;
        padding: 12px 14px;
        font-weight: 600;
        cursor: pointer;
      }
      .zoomBtn:hover {
        background: #1f1f1f;
      }
      /* Selected Layer badge in the canvas area */
      .layerBadge {
        position: absolute;
        left: 16px;
        top: 32px;
        z-index: 30;
        color: #666; /* same grey as sidebar titles */
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.04em;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu,
          Cantarell, "Helvetica Neue", Arial, "Noto Sans";
        background: none;
        padding: 0;
        margin: 0;
      }

      .layerBadge span {
        color: inherit;
        font: inherit;
        text-transform: inherit;
        letter-spacing: inherit;
      }

      .layerBadgeLabel {
        font-size: 12px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.04em;
        color: #666;
      }

      .layerBadgeValue {
        font-size: 20px;
        font-weight: 800;
        color: #111;
        line-height: 1.2;
        word-break: break-word;
      }
      /* ==== Prevent nested scrollbars inside layer sections ==== */
      #indicatorList,
      #indWrap,
      #subsWrap,
      #catsWrap,
      #dimsWrap,
      #subPills,
      #catPills,
      #dimPills {
        overflow: visible !important;
        max-height: none !important;
      }

      .section {
        overflow: visible !important;
      }

      .panelScroll {
        overflow-y: auto !important;
        overflow-x: hidden !important;
      }

      /* Hide all WebKit scrollbars inside children just in case */
      #indicatorList::-webkit-scrollbar,
      #indWrap::-webkit-scrollbar,
      #subsWrap::-webkit-scrollbar,
      #catsWrap::-webkit-scrollbar,
      #dimsWrap::-webkit-scrollbar {
        display: none !important;
      } /* === Adjust spacing between sidebar sections === */
      .section {
        margin-bottom: 40px; /* more air between layers */
      }

      /* Reduce excess space before the Clear Selection bar */
      .clearBar {
        margin-top: -12px; /* pull up the footer a bit */
        padding-top: 8px;
      } /* === Add more air below each section title === */
      .sectionHead {
        margin-bottom: 10px !important; /* was ~6px before */
      }

      /* Add top margin to lists/pills for clarity */
      #indicatorList,
      #subPills,
      #catPills,
      #dimPills {
        margin-top: 4px;
      }
      /* === Cross-highlight from viz hover to sidebar === */
      /* === Cross-highlight from viz hover to sidebar === */
      .indItem.hoverSync {
        background: rgba(237, 60, 26, 0.1);
        color: #ed3c1a !important;

        /* fake orange border box like the pills */
        box-shadow: 0 0 0 2px #ed3c1a inset;
        border-radius: 6px;
      }

      /* make the little left bar also orange on hoverSync */
      .indItem.hoverSync::before {
        background: #ed3c1a;
      }

      /* numbers on the right also go orange */
      .indItem.hoverSync .indVotes {
        color: #ed3c1a !important;
        opacity: 1;
      }

      /* pill hoverSync stays the same look */
      .pill.hoverSync {
        background: rgba(237, 60, 26, 0.1);
        border-color: #ed3c1a !important;
        color: #ed3c1a !important;
      }
      .pill.hoverSync .pillCount {
        color: #ed3c1a !important;
      }

      /* Orange outline around the "Votes" header when active */
      .votesHeaderWrap {
        position: relative;
        display: inline-flex;
        border-radius: 6px;
        /* no border by default */
      }

      .votesHeaderWrap.hlHeader::before {
        content: "";
        position: absolute;
        left: -6px;
        right: -6px;
        top: -4px;
        bottom: -4px;

        background: transparent;
        border: 2px solid #ed3c1a;
        border-radius: 6px;

        pointer-events: none;
        z-index: 0;
      }
      /* === HOVER SYNC STATE FOR THE "Votes 727" HEADER === */
      /* we reuse the class name `hoverSync` so JS can toggle it */

      .votesHeaderWrap.hoverSync::before {
        content: "";
        position: absolute;
        left: -6px;
        right: -6px;
        top: -4px;
        bottom: -4px;

        /* light orange fill like pills/rows on hover */
        background: rgba(237, 60, 26, 0.1);
        border: 2px solid #ed3c1a;
        border-radius: 6px;

        pointer-events: none;
        z-index: 0;
      }

      /* also tint the text "Votes 727" itself orange when synced */
      .votesHeaderWrap.hoverSync .votesHeaderBtn {
        color: #ed3c1a !important;
      }

      .votesHeaderWrap.hoverSync .topVotesNumber {
        color: #ed3c1a !important;
        opacity: 1 !important;
      }
    </style>
  </head>

  <body>
    <div class="wrap">
      <!-- SIDEBAR -->
      <aside class="panel" id="panel">
        <div class="panelScroll">
          <!-- TOP TITLE ROW -->
          <div class="titleTop">
            <h1 id="pageTitle">Community Data</h1>

            <div class="votesHeaderWrap" id="votesHeaderWrap">
              <button
                class="votesHeaderBtn right"
                id="votesHeaderBtn"
                type="button"
                title="Highlight all votes"
              >
                <span class="metaLabel">Votes</span>
                <span id="totalVotesHead" class="topVotesNumber">0</span>
              </button>
            </div>
          </div>

          <!-- INDICATORS SECTION -->
          <section class="section" id="sectionIndicators">
            <div class="sectionHead">
              <div class="leftHead">
                <div class="titleLine">
                  <h3>
                    Indicators
                    <span id="indCount" class="count"></span>
                  </h3>
                </div>
              </div>

              <button
                class="sectionToggleBtn"
                id="toggleInd"
                aria-expanded="false"
              >
                <span class="chev" aria-hidden="true">â–¾</span>
                <span class="toggleText" id="indToggleText">show all</span>
              </button>
            </div>

            <div id="indWrap">
              <ul class="indList" id="indicatorList"></ul>
            </div>
          </section>

          <!-- SUBCATEGORIES SECTION -->
          <section class="section" id="sectionSubcats">
            <div class="sectionHead">
              <div class="leftHead">
                <div class="titleLine">
                  <h3>
                    Subcategories
                    <span id="subCount" class="count"></span>
                  </h3>
                </div>
              </div>

              <button
                class="sectionToggleBtn"
                id="toggleSub"
                aria-expanded="false"
              >
                <span class="chev" aria-hidden="true">â–¾</span>
                <span class="toggleText" id="subToggleText">show all</span>
              </button>
            </div>

            <div id="subsWrap">
              <div id="subPills"></div>
            </div>
          </section>

          <!-- CATEGORIES SECTION -->
          <section class="section" id="sectionCats">
            <div class="sectionHead">
              <div class="leftHead">
                <div class="titleLine">
                  <h3>
                    Categories
                    <span id="catCount" class="count"></span>
                  </h3>
                </div>
              </div>

              <button
                class="sectionToggleBtn"
                id="toggleCat"
                aria-expanded="false"
              >
                <span class="chev" aria-hidden="true">â–¾</span>
                <span class="toggleText" id="catToggleText">show all</span>
              </button>
            </div>

            <div id="catsWrap">
              <div id="catPills"></div>
            </div>
          </section>

          <!-- DIMENSIONS SECTION -->
          <section class="section" id="sectionDims">
            <div class="sectionHead">
              <div class="leftHead">
                <div class="titleLine">
                  <h3>
                    Dimensions
                    <span id="dimCount" class="count"></span>
                  </h3>
                </div>
              </div>

              <button
                class="sectionToggleBtn"
                id="toggleDim"
                aria-expanded="false"
              >
                <span class="chev" aria-hidden="true">â–¾</span>
                <span class="toggleText" id="dimToggleText">show all</span>
              </button>
            </div>

            <div id="dimsWrap">
              <div id="dimPills"></div>
            </div>
          </section>
        </div>

        <!-- STICKY FOOTER -->
        <div class="clearBar">
          <div class="clearInner">
            <button id="clearBtn" class="clearBtn">Clear Selection</button>
          </div>
        </div>
      </aside>

      <!-- CANVAS AREA -->
      <div class="canvasWrap" id="p5-wrap">
        <div class="layerBadge" id="selectedLayerDisplay">
          <span class="layerBadgeLabel">Selected Layer:</span>
          <span class="layerBadgeValue" id="selectedLayerValue">None</span>
        </div>

        <button id="zoomBtn" class="zoomBtn">Zoom</button>
      </div>
    </div>

    <!-- LIBRARIES -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.3/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.9.0/d3.min.js"></script>

    <!-- MAIN SKETCH -->
    <script src="sketch.js"></script>
  </body>
</html>
